# for running tests locally and reporting coverage only on powercrud
set -euo pipefail

# delete any existing coverage reports
coverage erase
rm -rf htmlcov
rm -f coverage.xml

# All suites run under the lightweight test settings (manifest uses built files)
export DJANGO_SETTINGS_MODULE=tests.settings

# Core + async suite with coverage (skips Playwright)
pytest -m "not playwright" 

# Ensure the built bundle exists for manifest mode
echo "Building static assets for Playwright suite..."
npm run build

# Playwright UI checks
pytest -m playwright --cov-append --no-cov-on-fail

coverage html
